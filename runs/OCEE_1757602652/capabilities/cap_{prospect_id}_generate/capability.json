{
  "id": "cap_{prospect_id}_generate",
  "name": "{prospect_id}/generate",
  "purpose": "Receive Request",
  "title": "{prospect_id}/generate",
  "status": "healthy",
  "anchors": [
    {
      "path": "backend/app/routers/deck.py",
      "kind": "api",
      "route": "/{prospect_id}/generate"
    },
    {
      "path": "backend/app/routers/email.py",
      "kind": "api",
      "route": "/{prospect_id}/generate"
    }
  ],
  "lanes": {
    "web": [],
    "api": [
      {
        "path": "backend/app/__init__.py"
      },
      {
        "path": "backend/app/config.py"
      },
      {
        "path": "backend/app/database.py"
      },
      {
        "path": "backend/app/main.py"
      },
      {
        "path": "backend/app/models/__init__.py"
      },
      {
        "path": "backend/app/models/deck.py"
      },
      {
        "path": "backend/app/models/email.py"
      },
      {
        "path": "backend/app/models/prospect.py"
      },
      {
        "path": "backend/app/routers/__init__.py"
      },
      {
        "path": "backend/app/routers/deck.py"
      },
      {
        "path": "backend/app/routers/email.py"
      },
      {
        "path": "backend/app/routers/prospect.py"
      },
      {
        "path": "backend/app/schemas/__init__.py"
      },
      {
        "path": "backend/app/schemas/deck.py"
      },
      {
        "path": "backend/app/schemas/email.py"
      },
      {
        "path": "backend/app/schemas/prospect.py"
      },
      {
        "path": "backend/app/services/__init__.py"
      },
      {
        "path": "backend/app/services/ai.py"
      },
      {
        "path": "backend/app/services/emailgeneration.py"
      },
      {
        "path": "backend/app/services/pdf.py"
      },
      {
        "path": "backend/app/services/slides.py"
      },
      {
        "path": "backend/app/services/utils.py"
      },
      {
        "path": "backend/app/templates/deck.html"
      },
      {
        "path": "backend/migrate_add_phone.py"
      },
      {
        "path": "backend/requirements.txt"
      },
      {
        "path": "backend/static/init"
      }
    ],
    "workers": [],
    "other": []
  },
  "flow": [
    {
      "from": "backend/app/config.py",
      "to": "__future__",
      "kind": "call"
    },
    {
      "from": "backend/app/config.py",
      "to": "typing",
      "kind": "call"
    },
    {
      "from": "backend/app/config.py",
      "to": "pydantic",
      "kind": "call"
    },
    {
      "from": "backend/app/database.py",
      "to": "sqlalchemy.orm",
      "kind": "call"
    },
    {
      "from": "backend/app/database.py",
      "to": "config",
      "kind": "call"
    },
    {
      "from": "backend/app/main.py",
      "to": "__future__",
      "kind": "call"
    },
    {
      "from": "backend/app/main.py",
      "to": "fastapi",
      "kind": "call"
    },
    {
      "from": "backend/app/main.py",
      "to": "config",
      "kind": "call"
    },
    {
      "from": "backend/app/main.py",
      "to": "database",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/prospect.py",
      "to": "fastapi",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/prospect.py",
      "to": "sqlalchemy.orm",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/prospect.py",
      "to": "typing",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/prospect.py",
      "to": "database",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/deck.py",
      "to": "json",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/deck.py",
      "to": "fastapi",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/deck.py",
      "to": "sqlalchemy.orm",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/deck.py",
      "to": "pydantic",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/deck.py",
      "to": "typing",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/deck.py",
      "to": "database",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/deck.py",
      "to": "models.prospect",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/deck.py",
      "to": "models.deck",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/deck.py",
      "to": "schemas.deck",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/deck.py",
      "to": "services.ai",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/deck.py",
      "to": "services.pdf",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/deck.py",
      "to": "services.slides",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/deck.py",
      "to": "config",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/email.py",
      "to": "__future__",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/email.py",
      "to": "typing",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/email.py",
      "to": "fastapi",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/email.py",
      "to": "sqlalchemy.orm",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/email.py",
      "to": "pydantic",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/email.py",
      "to": "database",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/email.py",
      "to": "models.prospect",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/email.py",
      "to": "models.email",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/email.py",
      "to": "schemas.email",
      "kind": "call"
    },
    {
      "from": "backend/app/routers/email.py",
      "to": "services.emailgeneration",
      "kind": "call"
    },
    {
      "from": "backend/app/models/prospect.py",
      "to": "sqlalchemy.orm",
      "kind": "call"
    },
    {
      "from": "backend/app/models/prospect.py",
      "to": "database",
      "kind": "call"
    },
    {
      "from": "backend/app/models/deck.py",
      "to": "sqlalchemy.orm",
      "kind": "call"
    },
    {
      "from": "backend/app/models/deck.py",
      "to": "database",
      "kind": "call"
    },
    {
      "from": "backend/app/models/email.py",
      "to": "__future__",
      "kind": "call"
    },
    {
      "from": "backend/app/models/email.py",
      "to": "sqlalchemy.orm",
      "kind": "call"
    },
    {
      "from": "backend/app/models/email.py",
      "to": "database",
      "kind": "call"
    },
    {
      "from": "backend/app/schemas/prospect.py",
      "to": "pydantic",
      "kind": "call"
    },
    {
      "from": "backend/app/schemas/prospect.py",
      "to": "typing",
      "kind": "call"
    },
    {
      "from": "backend/app/schemas/deck.py",
      "to": "__future__",
      "kind": "call"
    },
    {
      "from": "backend/app/schemas/deck.py",
      "to": "typing",
      "kind": "call"
    },
    {
      "from": "backend/app/schemas/deck.py",
      "to": "pydantic",
      "kind": "call"
    },
    {
      "from": "backend/app/schemas/email.py",
      "to": "__future__",
      "kind": "call"
    },
    {
      "from": "backend/app/schemas/email.py",
      "to": "typing",
      "kind": "call"
    },
    {
      "from": "backend/app/schemas/email.py",
      "to": "pydantic",
      "kind": "call"
    },
    {
      "from": "backend/app/services/emailgeneration.py",
      "to": "__future__",
      "kind": "call"
    },
    {
      "from": "backend/app/services/emailgeneration.py",
      "to": "json",
      "kind": "call"
    },
    {
      "from": "backend/app/services/emailgeneration.py",
      "to": "typing",
      "kind": "call"
    },
    {
      "from": "backend/app/services/emailgeneration.py",
      "to": "config",
      "kind": "call"
    },
    {
      "from": "backend/app/services/ai.py",
      "to": "__future__",
      "kind": "call"
    },
    {
      "from": "backend/app/services/ai.py",
      "to": "json",
      "kind": "call"
    },
    {
      "from": "backend/app/services/ai.py",
      "to": "typing",
      "kind": "call"
    },
    {
      "from": "backend/app/services/ai.py",
      "to": "config",
      "kind": "call"
    },
    {
      "from": "backend/app/services/pdf.py",
      "to": "__future__",
      "kind": "call"
    },
    {
      "from": "backend/app/services/pdf.py",
      "to": "typing",
      "kind": "call"
    },
    {
      "from": "backend/app/services/pdf.py",
      "to": "config",
      "kind": "call"
    },
    {
      "from": "backend/app/services/slides.py",
      "to": "typing",
      "kind": "call"
    },
    {
      "from": "backend/app/services/slides.py",
      "to": "config",
      "kind": "call"
    }
  ],
  "data": {
    "inputs": [
      {
        "path": "backend/app/routers/deck.py",
        "why": "Handles incoming requests related to deck operations."
      },
      {
        "path": "backend/app/routers/email.py",
        "why": "Handles incoming requests related to email operations."
      },
      {
        "path": "backend/app/routers/prospect.py",
        "why": "Handles incoming requests related to prospect operations."
      }
    ],
    "stores": [
      {
        "path": "backend/app/database.py",
        "why": "Defines the database connection and ORM setup for data storage."
      },
      {
        "path": "backend/app/models/prospect.py",
        "why": "Defines the data model for prospects, representing stored data structure."
      },
      {
        "path": "backend/app/models/deck.py",
        "why": "Defines the data model for decks, representing stored data structure."
      },
      {
        "path": "backend/app/models/email.py",
        "why": "Defines the data model for emails, representing stored data structure."
      }
    ],
    "externals": [
      {
        "path": "fastapi",
        "why": "Framework used for building the web API."
      },
      {
        "path": "sqlalchemy.orm",
        "why": "ORM library used for database interactions."
      },
      {
        "path": "pydantic",
        "why": "Library used for data validation and settings management."
      }
    ]
  },
  "entrypoints": [
    "backend/app/routers/deck.py",
    "backend/app/routers/email.py"
  ],
  "entryPoints": [
    "backend/app/routers/deck.py",
    "backend/app/routers/email.py"
  ],
  "swimlanes": {
    "web": [],
    "api": [
      "backend/app/__init__.py",
      "backend/app/config.py",
      "backend/app/database.py",
      "backend/app/main.py",
      "backend/app/models/__init__.py",
      "backend/app/models/deck.py",
      "backend/app/models/email.py",
      "backend/app/models/prospect.py",
      "backend/app/routers/__init__.py",
      "backend/app/routers/deck.py",
      "backend/app/routers/email.py",
      "backend/app/routers/prospect.py",
      "backend/app/schemas/__init__.py",
      "backend/app/schemas/deck.py",
      "backend/app/schemas/email.py",
      "backend/app/schemas/prospect.py",
      "backend/app/services/__init__.py",
      "backend/app/services/ai.py",
      "backend/app/services/emailgeneration.py",
      "backend/app/services/pdf.py",
      "backend/app/services/slides.py",
      "backend/app/services/utils.py",
      "backend/app/templates/deck.html",
      "backend/migrate_add_phone.py",
      "backend/requirements.txt",
      "backend/static/init"
    ],
    "workers": [],
    "other": []
  },
  "control_flow": [],
  "data_flow": {
    "inputs": [],
    "stores": [],
    "externals": []
  },
  "policies": [
    {
      "path": "backend/app/config.py",
      "why": "Contains configuration settings that may dictate application behavior and policies.",
      "type": "unknown"
    },
    {
      "path": "backend/app/services/emailgeneration.py",
      "why": "Implements business logic related to email generation, enforcing operational policies.",
      "type": "unknown"
    },
    {
      "path": "backend/app/services/ai.py",
      "why": "Implements AI-related services, which may include policies for data handling and processing.",
      "type": "unknown"
    }
  ],
  "contracts": [
    {
      "path": "schemas.deck",
      "why": "Defines the schema for deck data, ensuring data structure consistency."
    },
    {
      "path": "schemas.email",
      "why": "Defines the schema for email data, ensuring data structure consistency."
    },
    {
      "path": "schemas.prospect",
      "why": "Defines the schema for prospect data, ensuring data structure consistency."
    }
  ],
  "summaries": {
    "file": {
      "backend/app/routers/deck.py": "",
      "backend/app/routers/email.py": "",
      "json": "",
      "fastapi": "",
      "sqlalchemy.orm": "",
      "pydantic": "",
      "typing": "",
      "database": "",
      "models.prospect": "",
      "models.deck": "",
      "schemas.deck": "",
      "services.ai": "",
      "services.pdf": "",
      "services.slides": "",
      "config": "",
      "__future__": "",
      "models.email": "",
      "schemas.email": "",
      "services.emailgeneration": "",
      "backend/app/services/emailgeneration.py": "",
      "backend/app/services/ai.py": "",
      "backend/app/main.py": "",
      "backend/app/routers/prospect.py": "",
      "backend/app/database.py": "",
      "backend/app/models/prospect.py": "",
      "backend/app/models/deck.py": "",
      "backend/app/models/email.py": "",
      "backend/app/config.py": "",
      "backend/app/schemas/prospect.py": "",
      "backend/app/schemas/deck.py": "",
      "backend/app/schemas/email.py": "",
      "backend/app/services/pdf.py": "",
      "backend/app/services/slides.py": ""
    },
    "folder": {
      "backend/app": ""
    },
    "narrative": [
      {
        "label": "Receive Request",
        "detail": "The API receives a request to generate a deck for a specific prospect.",
        "scenario": "A valid request is sent to the endpoint /{prospect_id}/generate."
      },
      {
        "label": "Validate Prospect ID",
        "detail": "The system checks if the provided prospect ID exists in the database.",
        "scenario": "The prospect ID is valid and exists in the database."
      },
      {
        "label": "Fetch Prospect Data",
        "detail": "The system retrieves the prospect's data from the database.",
        "scenario": "The prospect data is successfully fetched."
      },
      {
        "label": "Generate Deck Content",
        "detail": "The system generates the content for the deck using the prospect's data.",
        "scenario": "The content is generated without any issues."
      },
      {
        "label": "Create Deck Object",
        "detail": "A new deck object is created with the generated content.",
        "scenario": "The deck object is created successfully."
      },
      {
        "label": "Save Deck to Database",
        "detail": "The newly created deck is saved to the database.",
        "scenario": "The deck is saved without any errors."
      },
      {
        "label": "Send Confirmation Email",
        "detail": "An email is sent to the prospect confirming the deck generation.",
        "scenario": "The email is sent successfully."
      },
      {
        "label": "Return Success Response",
        "detail": "The API returns a success response to the client.",
        "scenario": "The response is returned with the generated deck details."
      }
    ]
  },
  "keyFiles": [
    "__future__",
    "backend/app/routers/deck.py",
    "backend/app/routers/email.py",
    "config",
    "sqlalchemy.orm",
    "typing"
  ],
  "steps": [
    {
      "title": "Receive Request",
      "description": "The API receives a request to generate a deck for a specific prospect.",
      "fileId": "backend/app/routers/deck.py"
    },
    {
      "title": "Validate Prospect ID",
      "description": "The system checks if the provided prospect ID exists in the database.",
      "fileId": null
    },
    {
      "title": "Fetch Prospect Data",
      "description": "The system retrieves the prospect's data from the database.",
      "fileId": null
    },
    {
      "title": "Generate Deck Content",
      "description": "The system generates the content for the deck using the prospect's data.",
      "fileId": null
    },
    {
      "title": "Create Deck Object",
      "description": "A new deck object is created with the generated content.",
      "fileId": null
    },
    {
      "title": "Save Deck to Database",
      "description": "The newly created deck is saved to the database.",
      "fileId": null
    },
    {
      "title": "Send Confirmation Email",
      "description": "An email is sent to the prospect confirming the deck generation.",
      "fileId": null
    },
    {
      "title": "Return Success Response",
      "description": "The API returns a success response to the client.",
      "fileId": null
    }
  ],
  "dataIn": [],
  "dataOut": [],
  "orchestrators": [],
  "sources": [
    "backend/app/routers/deck.py",
    "backend/app/routers/email.py"
  ],
  "sinks": [],
  "controlFlow": [],
  "dataFlow": {
    "inputs": [],
    "stores": [],
    "externals": []
  },
  "nodeIndex": {
    "backend/app/services/__init__.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/services/pdf.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/routers/__init__.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/routers/email.py": {
      "role": "entrypoint",
      "lane": "web"
    },
    "backend/app/routers/deck.py": {
      "role": "entrypoint",
      "lane": "web"
    },
    "backend/app/routers/prospect.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/models/prospect.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/schemas/__init__.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/main.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/services/slides.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/services/emailgeneration.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/models/deck.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/models/__init__.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/schemas/deck.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/database.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/__init__.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/config.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/requirements.txt": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/schemas/email.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/templates/deck.html": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/migrate_add_phone.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/services/ai.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/static/init": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/models/email.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/services/utils.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    },
    "backend/app/schemas/prospect.py": {
      "lane": "api",
      "role": "sink",
      "incoming": [],
      "outgoing": [],
      "policies": [],
      "envs": [],
      "relatedData": []
    }
  },
  "suspectRank": [],
  "recentChanges": []
}